<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Novel Dialogue Enhancer - Settings</title>
    <link rel="stylesheet" href="options.css" />
    <link rel="icon" href="../assets/icons/icon128.png" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
  </head>

  <body>
    <div class="wrapper">
      <header>
        <img
          src="../assets/icons/icon128.png"
          alt="Novel Dialogue Enhancer"
          class="header-icon"
        />
        <h1>Novel Dialogue Enhancer</h1>
        <p>Configure your settings for optimal dialogue enhancement</p>
      </header>

      <div class="theme-toggle">
        <span class="theme-icon light-icon">‚òÄÔ∏è</span>
        <label class="switch">
          <input type="checkbox" id="theme-switch" />
          <span class="slider round"></span>
        </label>
        <span class="theme-icon dark-icon">üåô</span>
      </div>

      <div class="tabs-container">
        <div class="tabs">
          <button class="tab-btn active" data-tab="general">General</button>
          <button class="tab-btn" data-tab="advanced">Advanced</button>
          <button class="tab-btn" data-tab="novels">My Novels</button>
          <button class="tab-btn" data-tab="sites">Whitelisted Sites</button>
          <button class="tab-btn" data-tab="stats">Statistics</button>
          <button class="tab-btn" data-tab="about">About</button>
        </div>

        <div class="tab-content">
          <!-- General Tab -->
          <div class="tab-pane active" id="general-tab">
            <div class="card">
              <h3>Model Settings</h3>
              <div class="form-group">
                <label for="model-name">Ollama Model Name</label>
                <input id="model-name" type="text" placeholder="qwen3:8b" />
                <div class="hint">
                  Specify which Ollama model to use for text enhancement.
                </div>
                <div class="model-suggestions">
                  <span class="model-suggestion" data-model="qwen3:8b"
                    >qwen3:8b</span
                  >
                  <span class="model-suggestion" data-model="llama3:8b"
                    >llama3:8b</span
                  >
                  <span class="model-suggestion" data-model="phi3:medium"
                    >phi3:medium</span
                  >
                </div>
              </div>
            </div>

            <div class="card">
              <h3>Generation Parameters</h3>
              <div class="slider-container">
                <label for="temperature">
                  Temperature
                  <span id="temperature-value" class="slider-value">0.4</span>
                </label>
                <input
                  type="range"
                  id="temperature"
                  min="0.1"
                  max="1.0"
                  step="0.1"
                  value="0.4"
                />
                <div class="slider-labels">
                  <span>Consistent</span>
                  <span>Creative</span>
                </div>
                <div class="hint">
                  Controls creativity vs. predictability. Lower values (0.1-0.4)
                  produce more consistent outputs, while higher values (0.7-1.0)
                  increase creativity.
                </div>
              </div>

              <div class="slider-container">
                <label for="top-p">
                  Top P (Nucleus Sampling)
                  <span id="top-p-value" class="slider-value">0.9</span>
                </label>
                <input
                  type="range"
                  id="top-p"
                  min="0.1"
                  max="1.0"
                  step="0.1"
                  value="0.9"
                />
                <div class="slider-labels">
                  <span>Focused</span>
                  <span>Diverse</span>
                </div>
                <div class="hint">
                  Controls diversity of language. Lower values focus on likely
                  words, higher values permit more diverse vocabulary.
                </div>
              </div>
            </div>
          </div>

          <!-- Advanced Tab -->
          <div class="tab-pane" id="advanced-tab">
            <div class="card">
              <h3>Performance Settings</h3>
              <div class="slider-container">
                <label for="max-chunk-size">
                  Maximum Chunk Size
                  <span id="max-chunk-size-value" class="slider-value"
                    >8000</span
                  >
                </label>
                <input
                  type="range"
                  id="max-chunk-size"
                  min="2000"
                  max="16000"
                  step="1000"
                  value="8000"
                />
                <div class="slider-labels">
                  <span>2K</span>
                  <span>16K</span>
                </div>
                <div class="hint">
                  Sets the maximum size of text chunks sent to Ollama. Lower
                  values are faster but may reduce quality.
                </div>
              </div>

              <div class="slider-container">
                <label for="timeout">
                  LLM Request Timeout
                  <span id="timeout-value" class="slider-value">120</span>
                </label>
                <input
                  type="range"
                  id="timeout"
                  min="30"
                  max="300"
                  step="30"
                  value="120"
                />
                <div class="slider-labels">
                  <span>30s</span>
                  <span>300s</span>
                </div>
                <div class="hint">
                  Maximum time to wait for LLM responses in seconds.
                </div>
              </div>
              <div class="form-group">
                <label for="debug-mode">
                  <input type="checkbox" id="debug-mode" />
                  Enable Debug Logging
                </label>
                <small class="help-text">Show detailed technical logs in browser console</small>
              </div>
            </div>

            

            <div class="card">
              <h3>Ollama Connection</h3>
              <div class="form-group">
                <button id="test-ollama" class="button button-secondary">
                  <span class="button-icon">üîå</span> Test Ollama Connection
                </button>
                <div
                  id="ollama-status"
                  class="status-message"
                  style="display: none"
                ></div>
              </div>
              <div class="hint">
                Make sure Ollama is running on your system before testing the
                connection.
              </div>
            </div>
          </div>

          <!-- Novels Tab -->
          <div class="tab-pane" id="novels-tab">
            <div class="card">
              <h3>Detected Novels</h3>
              <div class="hint">
                Below are novels that the extension has processed. You can view
                characters detected in each novel.
              </div>

              <div class="novels-search-container">
                <input
                  type="text"
                  id="novels-search"
                  placeholder="Search novels..."
                  class="search-input"
                />
              </div>

              <div id="novels-container" class="novels-container">
                <div class="empty-list">No novels detected yet</div>
              </div>
            </div>
          </div>

          <!-- Whitelist Tab -->
          <div class="tab-pane" id="sites-tab">
            <div class="card">
              <h3>Site Whitelist</h3>
              <div class="hint">
                Only websites in this list will be processed by the Novel
                Dialogue Enhancer.
              </div>
              <div class="whitelist-container">
                <div id="whitelist-items">
                  <div class="empty-list">No sites in whitelist</div>
                </div>
              </div>

              <button id="add-site" class="button button-secondary">
                <span class="button-icon">‚ûï</span> Add Site Manually
              </button>

              <button id="clear-all" class="button button-danger">
                <span class="button-icon">üóëÔ∏è</span> Clear All Sites
              </button>
            </div>
          </div>

          <!-- Stats Tab -->
          <div class="tab-pane" id="stats-tab">
            <div class="card">
              <h3>Enhancement Statistics</h3>
              <div class="hint">
                Track your usage of the Novel Dialogue Enhancer across all
                novels and sessions.
              </div>

              <div class="stats-grid">
                <div class="stat-card">
                  <div class="stat-value" id="stat-paragraphs">0</div>
                  <div class="stat-label">Paragraphs Enhanced</div>
                </div>

                <div class="stat-card">
                  <div class="stat-value" id="stat-chapters">0</div>
                  <div class="stat-label">Chapters Enhanced</div>
                </div>

                <div class="stat-card">
                  <div class="stat-value" id="stat-novels">0</div>
                  <div class="stat-label">Unique Novels</div>
                </div>

                <div class="stat-card">
                  <div class="stat-value" id="stat-characters">0</div>
                  <div class="stat-label">Characters Detected</div>
                </div>

                <div class="stat-card">
                  <div class="stat-value" id="stat-sessions">0</div>
                  <div class="stat-label">Enhancement Sessions</div>
                </div>

                <div class="stat-card">
                  <div class="stat-value" id="stat-time">0m</div>
                  <div class="stat-label">Total Processing Time</div>
                </div>
              </div>

              <div class="stats-timeline">
                <div class="timeline-item">
                  <span class="timeline-label">First Enhancement:</span>
                  <span id="stat-first-date" class="timeline-value">Never</span>
                </div>
                <div class="timeline-item">
                  <span class="timeline-label">Last Enhancement:</span>
                  <span id="stat-last-date" class="timeline-value">Never</span>
                </div>
              </div>

              <div class="stats-actions">
                <button id="refresh-stats" class="button button-secondary">
                  <span class="button-icon">üîÑ</span> Refresh Statistics
                </button>
                <button id="reset-stats" class="button button-danger">
                  <span class="button-icon">üóëÔ∏è</span> Reset Statistics
                </button>
              </div>
            </div>
          </div>

          <!-- About Tab -->
          <div class="tab-pane" id="about-tab">
            <div class="card">
              <h3>About Novel Dialogue Enhancer</h3>
              <div class="about-content">
                <p>
                  Novel Dialogue Enhancer is a browser extension that uses AI to
                  improve translated novel dialogues, making them sound more
                  natural and fluent.
                </p>
                <p>
                  <strong>Version:</strong> 1.0<br />
                  <strong>Requirements:</strong> Ollama must be installed and
                  running on your local machine.
                </p>
                <h4>How to Use:</h4>
                <ol>
                  <li>
                    Install and set up
                    <a href="https://ollama.com" target="_blank">Ollama</a> on
                    your computer
                  </li>
                  <li>
                    Pull AI model that you want to run with Ollama (example :
                    <a href="https://ollama.com/library/qwen3" target="_blank"
                      >ollama pull qwen3:8b</a
                    >)
                  </li>
                  <li>
                    Run command <code>ollama serve</code> to make your local AI
                    model available to this extension
                  </li>
                  <li>
                    Add your favorite novel sites to the whitelist (click
                    extension icon or this page)
                  </li>
                  <li>Configure your preferences on this page</li>
                </ol>
                <h4>Supported Websites:</h4>
                <ul>
                  <li>fanmtl.com</li>
                  <li>novelupdates.com</li>
                  <li>wuxiaworld.com</li>
                  <li>webnovel.com</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="actions">
        <button id="save" class="button button-primary">
          <span class="button-icon">üíæ</span> Save Settings
        </button>
        <button id="reset" class="button button-secondary">
          <span class="button-icon">‚Ü©Ô∏è</span> Reset to Defaults
        </button>
      </div>

      <div id="site-modal" class="modal">
        <div class="modal-content">
          <div class="modal-header">
            <h3>Add Site to Whitelist</h3>
            <span class="close-modal">&times;</span>
          </div>
          <div class="modal-body">
            <div class="form-group">
              <label for="site-url">Website URL</label>
              <input
                id="site-url"
                type="text"
                placeholder="https://www.example.com"
              />
              <div class="hint">
                Don't include the protocol (http:// or https://) and any paths
                or query parameters at the end.
              </div>
              <div
                id="modal-error"
                class="hint error-hint"
                style="display: none"
              ></div>
            </div>
          </div>
          <div class="modal-footer">
            <button id="add-site-confirm" class="button button-primary">
              <span class="button-icon">‚úì</span> Add Site
            </button>
            <button id="cancel-add-site" class="button button-secondary">
              <span class="button-icon">‚úï</span> Cancel
            </button>
          </div>
        </div>
      </div>
    </div>
    <script src="../assets/js/utils/dark-mode-manager.js"></script>
    <script src="../assets/js/utils/logger.js"></script>
    <script src="options.js"></script>
  </body>
</html>
